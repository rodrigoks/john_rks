<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="transportadora">

    <insert id="insert" parameterType="TransportadoraVO" useGeneratedKeys="true" keyProperty="id" >

        INSERT INTO logbook05_transportadoras (
            flogbook05_razao_social,
            flogbook05_data_cadastro,
            flogbook05_responsavel,
            flogbook05_apelido
        ) VALUES
        <foreach collection="collection" item="item" index="index" open="(" separator="),(" close=")" >
            #{item.razaoSocial},
            #{item.dataCadastro},
            #{item.responsavel},
            #{item.apelido}
        </foreach>

    </insert>

    <update id="update" parameterType="TransportadoraVO">

        <foreach collection="collection" item="item" index="index" separator=";">
            UPDATE
              logbook05_transportadoras
            SET
              flogbook05_razao_social = #{item.razaoSocial},
              flogbook05_data_cadastro = #{item.dataCadastro},
              flogbook05_responsavel = #{item.responsavel},
              flogbook05_apelido = #{item.apelido}
            WHERE
              flogbook05_id = #{item.id};
        </foreach>

    </update>

    <delete id="delete" parameterType="TransportadoraVO">
        DELETE FROM
          logbook05_transportadoras
        WHERE
          flogbook05_id = #{id};
    </delete>

    <delete id="deleteByLista" parameterType="TransportadoraVO">
        DELETE FROM
          logbook05_transportadoras
        WHERE
          flogbook05_id
        IN
        <foreach collection="colTransportadorasInteger" item="item" index="index" open="(" separator="," close=")" >
            #{item}
        </foreach>
    </delete>

    <select id="select" resultMap="result" parameterType="TransportadoraVO" >
        SELECT
          logbook05_transportadoras.*,
  		  logbook06_cnpjs_transportadoras.*
        FROM
          logbook05_transportadoras
        INNER JOIN
          logbook06_cnpjs_transportadoras
        ON
          logbook05_transportadoras.flogbook05_id = logbook06_cnpjs_transportadoras.flogbook05_id
        <if test="user.group.group == 'WSATransportadora'">
	        INNER JOIN
			  logbook16_transportadoras_usuarios
			ON
			  logbook05_transportadoras.flogbook05_id = logbook16_transportadoras_usuarios.flogbook05_id
			INNER JOIN
			  tscy02h_usuario
			ON
			  tscy02h_usuario.ascy02_id = logbook16_transportadoras_usuarios.fscy02_id
			WHERE
			  tscy02h_usuario.ascy02_id = #{user.id}
		</if>
        ORDER BY
          flogbook05_apelido
    </select>

    <select id="selectByFilter" resultMap="result" parameterType="TransportadoraVO" >
        SELECT
          *
        FROM
          logbook05_transportadoras
        INNER JOIN
          logbook06_cnpjs_transportadoras
        ON
          logbook05_transportadoras.flogbook05_id = logbook06_cnpjs_transportadoras.flogbook05_id
        WHERE
          lower(flogbook05_razao_social)
        LIKE
          '%' || lower(#{razaoSocial}) || '%'
        ORDER BY
            flogbook05_apelido
    </select>

    <select id="selectDuplicity" resultMap="result" parameterType="TransportadoraVO" >
        SELECT
          *
        FROM
          logbook05_transportadoras
        INNER JOIN
          logbook06_cnpjs_transportadoras
        ON
          logbook05_transportadoras.flogbook05_id = logbook06_cnpjs_transportadoras.flogbook05_id
        WHERE
          flogbook06_cnpj
        IN
        <foreach collection="colCnpjs" item="item" index="index" open="(" separator="," close=")" >
            #{item.cnpj}
        </foreach>
        ORDER BY
          flogbook05_apelido
    </select>

    <select id="selectUnique" resultMap="result" parameterType="TransportadoraVO" >
        SELECT
          *
        FROM
          logbook05_transportadoras
        INNER JOIN
          logbook06_cnpjs_transportadoras
        ON
          logbook05_transportadoras.flogbook05_id = logbook06_cnpjs_transportadoras.flogbook05_id
        WHERE
          logbook05_transportadoras.flogbook05_id = #{id};
    </select>

    <resultMap id="result" type="TransportadoraVO">
        <id property="id" column="flogbook05_id" />
        <result property="razaoSocial" column="flogbook05_razao_social" />
        <result property="apelido" column="flogbook05_apelido" />
        <result property="dataCadastro" column="flogbook05_data_cadastro" />
        <result property="responsavel" column="flogbook05_responsavel" />
        <collection property="colCnpjs" ofType="CnpjTransportadoraVO">
	        <id property="id" column="flogbook06_id"/>
	    	<result property="cnpj" column="flogbook06_cnpj" />
        </collection>
    </resultMap>

</mapper>