<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="associar">

    <insert id="insert" parameterType="AssociarVO" useGeneratedKeys="true" keyProperty="id" >

        INSERT INTO logbook16_transportadoras_usuarios (
            flogbook05_id,
            fscy02_id,
            flogbook16_ultima_atualizacao
        ) VALUES (
            #{transportadora.id},
            #{usuario.id},
            #{ultimaAtualizacao}
        )

    </insert>

    <delete id="delete" parameterType="AssociarVO">
        DELETE FROM
          logbook16_transportadoras_usuarios
        WHERE
          flogbook16_id = #{id};
    </delete>

    <select id="select" resultMap="result" >
        SELECT * FROM 
			logbook16_transportadoras_usuarios
		INNER JOIN
			logbook05_transportadoras
		ON 
			logbook16_transportadoras_usuarios.flogbook05_id = logbook05_transportadoras.flogbook05_id
		INNER JOIN
			tscy02h_usuario
		ON
			tscy02h_usuario.ascy02_id = logbook16_transportadoras_usuarios.fscy02_id
		ORDER BY
			tscy02h_usuario.ascy02_nome
    </select>
    
    <select id="selectUnique" resultMap="result" parameterType="AssociarVO" >
        SELECT * FROM 
			logbook16_transportadoras_usuarios
		INNER JOIN
			logbook05_transportadoras
		ON 
			logbook16_transportadoras_usuarios.flogbook05_id = logbook05_transportadoras.flogbook05_id
		INNER JOIN
			tscy02h_usuario
		ON
			tscy02h_usuario.ascy02_id = logbook16_transportadoras_usuarios.fscy02_id
		WHERE
			flogbook16_id = #{id}
		ORDER BY
			tscy02h_usuario.ascy02_nome
    </select>

    <select id="selectDuplicity" resultMap="result" parameterType="AssociarVO" >
        SELECT * FROM 
			logbook16_transportadoras_usuarios
		WHERE
			logbook16_transportadoras_usuarios.fscy02_id = #{usuario.id}
		AND
			logbook16_transportadoras_usuarios.flogbook05_id = #{transportadora.id}
    </select>

    <resultMap id="result" type="AssociarVO">
    	<id property="id" column="flogbook16_id" />
        <result property="ultimaAtualizacao" column="flogbook16_ultima_atualizacao" />
        <association property="transportadora" javaType="TransportadoraVO">
            <id property="id" column="flogbook05_id" />
	        <result property="razaoSocial" column="flogbook05_razao_social" />
	        <result property="apelido" column="flogbook05_apelido" />
	        <result property="dataCadastro" column="flogbook05_data_cadastro" />
	        <result property="responsavel" column="flogbook05_responsavel" />
        </association>
        <association property="usuario" javaType="JUserVO">
            <id property="id" column="ascy02_id" />
			<result property="name" column="ascy02_nome" />
			<result property="email" column="ascy02_email" />
			<result property="insertDate" column="ascy02_data_cadastro" />
        </association>
    </resultMap>

</mapper>