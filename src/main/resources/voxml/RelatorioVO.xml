<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="relatorio">

    <select id="select" resultMap="result" parameterType="Relatorio" >
        SELECT
        	*
        FROM
        	logbook04_relatorios
        INNER JOIN
        	logbook03_tipos_relatorios
        ON
        	logbook04_relatorios.flogbook03_id = logbook03_tipos_relatorios.flogbook03_id
        WHERE
        	flogbook01_id = #{modulo.id}
        AND
        	flogbook04_visivel = TRUE
       	<if test="user.group.group == 'WSATransportadora'">
		  AND
		    flogbook04_is_auditoria = false
		</if>
        ORDER BY
        	flogbook04_nome_arquivo
    </select>
    
    <select id="selectbyid" resultMap="result" parameterType="Relatorio" >
        SELECT
        	*
        FROM
        	logbook04_relatorios
        INNER JOIN
        	logbook03_tipos_relatorios
        ON
        	logbook04_relatorios.flogbook03_id = logbook03_tipos_relatorios.flogbook03_id
        WHERE
        	flogbook04_id = #{id}
    </select>

    <select id="selectByIndice" resultMap="result" parameterType="Relatorio" >
        SELECT
        	*
        FROM
        	logbook04_relatorios
        INNER JOIN
        	logbook03_tipos_relatorios
        ON
        	logbook04_relatorios.flogbook03_id = logbook03_tipos_relatorios.flogbook03_id
        WHERE
        	flogbook04_indice_grupo = #{indiceGrupo}
        ORDER BY
        	flogbook04_id
    </select>

    <resultMap id="result" type="Relatorio">
        <result property="id" column="flogbook04_id" />
        <result property="nomeArquivo" column="flogbook04_nome_arquivo" />
        <result property="nomeRelatorio" column="flogbook04_nome_relatorio" />
        <result property="indiceGrupo" column="flogbook04_indice_grupo" />
        <result property="nomeAba" column="flogbook04_nome_aba" />
        <result property="dataCadastro" column="flogbook04_data_cadastro" />
        <result property="auditoria" column="flogbook04_is_auditoria" />
        <association property="tipoRelatorio" javaType="TipoRelatorio">
            <id property="id" column="flogbook03_id" />
            <result property="tipo" column="flogbook03_tipo" />
        </association>
    </resultMap>

</mapper>